name: Enviar Issues para brunocgc/contabil

on:
  issues:
    types: [opened]

jobs:
  forward-issue:
    name: Replicar Issue para brunocgc/contabil
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Criar issue no reposit√≥rio brunocgc/contabil
        uses: actions/github-script@v7
        with:
          # IMPORTANTE: Para acessar reposit√≥rios privados externos, √© necess√°rio um PAT
          # Crie um Personal Access Token com permiss√µes 'repo' em https://github.com/settings/tokens
          # Adicione o token como secret 'CONTABIL_PAT' nas configura√ß√µes do reposit√≥rio
          github-token: ${{ secrets.CONTABIL_PAT }}
          script: |
            const originalIssue = context.payload.issue;
            const originalRepo = context.repo.repo;
            const originalOwner = context.repo.owner;
            
            // Informa√ß√µes da issue original
            const issueTitle = originalIssue.title;
            const issueBody = originalIssue.body || '';
            const issueUser = originalIssue.user.login;
            const issueUrl = originalIssue.html_url;
            const issueNumber = originalIssue.number;
            
            // Labels da issue original
            const originalLabels = originalIssue.labels.map(label => label.name);
            
            // Criar corpo da nova issue com refer√™ncia √† original
            const linkIcon = 'üîó';
            const userIcon = 'üë§';
            const repoIcon = 'üìç';
            const newIssueBody = `> ${linkIcon} **Issue original:** ${issueUrl}\n` +
              `> ${userIcon} **Criado por:** @${issueUser}\n` +
              `> ${repoIcon} **Reposit√≥rio:** ${originalOwner}/${originalRepo}#${issueNumber}\n\n` +
              `---\n\n${issueBody}`;

            try {
              // Criar a issue no reposit√≥rio de destino
              const newIssue = await github.rest.issues.create({
                owner: 'brunocgc',
                repo: 'contabil',
                title: `[${originalOwner}/${originalRepo}#${issueNumber}] ${issueTitle}`,
                body: newIssueBody,
                labels: originalLabels.length > 0 ? originalLabels : undefined
              });

              console.log(`‚úÖ Issue criada com sucesso em brunocgc/contabil: ${newIssue.data.html_url}`);

              // Adicionar coment√°rio na issue original com link para a nova issue
              await github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `‚úÖ Esta issue foi automaticamente enviada para brunocgc/contabil.\n\nüîó Link: ${newIssue.data.html_url}`
              });

            } catch (error) {
              console.error('‚ùå Erro ao criar issue:', error);
              
              // Adicionar coment√°rio na issue original informando o erro
              await github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `‚ö†Ô∏è N√£o foi poss√≠vel enviar automaticamente esta issue para brunocgc/contabil.\n\nErro: ${error.message}\n\nPor favor, verifique as permiss√µes do workflow.`
              });
            }
